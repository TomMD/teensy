<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LUFA Library - Combined Mass Storage and Keyboard Device Demo: Lib/DataflashManager.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1908313087c3aad689e6cab0c688dbe1.html">Lib</a>
  </div>
</div>
<div class="contents">
<h1>DataflashManager.c File Reference</h1><code>#include &quot;<a class="el" href="a00007.html">DataflashManager.h</a>&quot;</code><br/>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a128d1f5e4f5e06411a7bc62896812bc7">INCLUDE_FROM_DATAFLASHMANAGER_C</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#ada94748152b7ee8cc656a621f8745bf4">DataflashManager_WriteBlocks</a> (USB_ClassInfo_MS_Device_t *MSInterfaceInfo, const uint32_t BlockAddress, uint16_t TotalBlocks)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a751320552e813c33d386770c97974584">DataflashManager_ReadBlocks</a> (USB_ClassInfo_MS_Device_t *MSInterfaceInfo, const uint32_t BlockAddress, uint16_t TotalBlocks)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#a4adb78d9f016280332cf5fc464d5d51d">DataflashManager_WriteBlocks_RAM</a> (const uint32_t BlockAddress, uint16_t TotalBlocks, uint8_t *BufferPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#aed6088eacdd69b790163a10a2dd51d71">DataflashManager_ReadBlocks_RAM</a> (const uint32_t BlockAddress, uint16_t TotalBlocks, uint8_t *BufferPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html#adb32091fc613a95c74b5e2aeb796edcb">DataflashManager_ResetDataflashProtections</a> (void)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Functions to manage the physical dataflash media, including reading and writing of blocks of data. These functions are called by the SCSI layer when data must be stored or retrieved to/from the physical storage media. If a different media is used (such as a SD card or EEPROM), functions similar to these will need to be generated. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a128d1f5e4f5e06411a7bc62896812bc7"></a><!-- doxytag: member="DataflashManager.c::INCLUDE_FROM_DATAFLASHMANAGER_C" ref="a128d1f5e4f5e06411a7bc62896812bc7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INCLUDE_FROM_DATAFLASHMANAGER_C</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a751320552e813c33d386770c97974584"></a><!-- doxytag: member="DataflashManager.c::DataflashManager_ReadBlocks" ref="a751320552e813c33d386770c97974584" args="(USB_ClassInfo_MS_Device_t *MSInterfaceInfo, const uint32_t BlockAddress, uint16_t TotalBlocks)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DataflashManager_ReadBlocks </td>
          <td>(</td>
          <td class="paramtype">USB_ClassInfo_MS_Device_t *&nbsp;</td>
          <td class="paramname"> <em>MSInterfaceInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t&nbsp;</td>
          <td class="paramname"> <em>BlockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>TotalBlocks</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reads blocks (OS blocks, not Dataflash pages) from the storage medium, the board dataflash IC(s), into the pre-selected data IN endpoint. This routine reads in Dataflash page sized blocks from the Dataflash and writes them in OS sized blocks to the endpoint.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>MSInterfaceInfo</em>&nbsp;</td><td>Pointer to a structure containing a Mass Storage Class configuration and state </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>BlockAddress</em>&nbsp;</td><td>Data block starting address for the read sequence </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>TotalBlocks</em>&nbsp;</td><td>Number of blocks of data to read </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aed6088eacdd69b790163a10a2dd51d71"></a><!-- doxytag: member="DataflashManager.c::DataflashManager_ReadBlocks_RAM" ref="aed6088eacdd69b790163a10a2dd51d71" args="(const uint32_t BlockAddress, uint16_t TotalBlocks, uint8_t *BufferPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DataflashManager_ReadBlocks_RAM </td>
          <td>(</td>
          <td class="paramtype">const uint32_t&nbsp;</td>
          <td class="paramname"> <em>BlockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>TotalBlocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>BufferPtr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reads blocks (OS blocks, not Dataflash pages) from the storage medium, the board dataflash IC(s), into the a preallocated RAM buffer. This routine reads in Dataflash page sized blocks from the Dataflash and writes them in OS sized blocks to the given buffer. This can be linked to FAT libraries to read the files stored on the dataflash.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>BlockAddress</em>&nbsp;</td><td>Data block starting address for the read sequence </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>TotalBlocks</em>&nbsp;</td><td>Number of blocks of data to read </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>BufferPtr</em>&nbsp;</td><td>Pointer to the data destination RAM buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="adb32091fc613a95c74b5e2aeb796edcb"></a><!-- doxytag: member="DataflashManager.c::DataflashManager_ResetDataflashProtections" ref="adb32091fc613a95c74b5e2aeb796edcb" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DataflashManager_ResetDataflashProtections </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Disables the dataflash memory write protection bits on the board Dataflash ICs, if enabled. </p>

</div>
</div>
<a class="anchor" id="ada94748152b7ee8cc656a621f8745bf4"></a><!-- doxytag: member="DataflashManager.c::DataflashManager_WriteBlocks" ref="ada94748152b7ee8cc656a621f8745bf4" args="(USB_ClassInfo_MS_Device_t *MSInterfaceInfo, const uint32_t BlockAddress, uint16_t TotalBlocks)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DataflashManager_WriteBlocks </td>
          <td>(</td>
          <td class="paramtype">USB_ClassInfo_MS_Device_t *&nbsp;</td>
          <td class="paramname"> <em>MSInterfaceInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t&nbsp;</td>
          <td class="paramname"> <em>BlockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>TotalBlocks</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Writes blocks (OS blocks, not Dataflash pages) to the storage medium, the board dataflash IC(s), from the pre-selected data OUT endpoint. This routine reads in OS sized blocks from the endpoint and writes them to the dataflash in Dataflash page sized blocks.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>MSInterfaceInfo</em>&nbsp;</td><td>Pointer to a structure containing a Mass Storage Class configuration and state </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>BlockAddress</em>&nbsp;</td><td>Data block starting address for the write sequence </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>TotalBlocks</em>&nbsp;</td><td>Number of blocks of data to write </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a4adb78d9f016280332cf5fc464d5d51d"></a><!-- doxytag: member="DataflashManager.c::DataflashManager_WriteBlocks_RAM" ref="a4adb78d9f016280332cf5fc464d5d51d" args="(const uint32_t BlockAddress, uint16_t TotalBlocks, uint8_t *BufferPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DataflashManager_WriteBlocks_RAM </td>
          <td>(</td>
          <td class="paramtype">const uint32_t&nbsp;</td>
          <td class="paramname"> <em>BlockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>TotalBlocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>BufferPtr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Writes blocks (OS blocks, not Dataflash pages) to the storage medium, the board dataflash IC(s), from the a given RAM buffer. This routine reads in OS sized blocks from the buffer and writes them to the dataflash in Dataflash page sized blocks. This can be linked to FAT libraries to write files to the dataflash.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>BlockAddress</em>&nbsp;</td><td>Data block starting address for the write sequence </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>TotalBlocks</em>&nbsp;</td><td>Number of blocks of data to write </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>BufferPtr</em>&nbsp;</td><td>Pointer to the data source RAM buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Dec 2009 for LUFA Library - Combined Mass Storage and Keyboard Device Demo by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
