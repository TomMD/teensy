<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LUFA Library - CDC Class Bootloader: BootloaderCDC.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>BootloaderCDC.c File Reference</h1><code>#include &quot;<a class="el" href="a00004.html">BootloaderCDC.h</a>&quot;</code><br/>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a80f96189a34ca94c3f3a4b4e95f2aed3">INCLUDE_FROM_BOOTLOADERCDC_C</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#acb27e569c06a2797c5fd58ed39147448">SetupHardware</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a5aa92c37b3202c4fa9e17b76cf72c9a7">ResetHardware</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a953a275884b9e33629ff6323fca05252">EVENT_USB_Device_ConfigurationChanged</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#abbebc3cb66ac3945b938ae5b93a71ea8">EVENT_USB_Device_UnhandledControlRequest</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a544da7e0b12c53fa786563a27c993d2d">ReadWriteMemoryBlock</a> (const uint8_t Command)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a31154d0202e81e96201b74ce3817a187">FetchNextCommandByte</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a145c971e0691d08d5e8be6ceda7f20fd">WriteNextResponseByte</a> (const uint8_t Response)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a30b631d779b4fda01351df830602c146">CDC_Task</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="a00001.html">CDC_Line_Coding_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a95109883f628ac6b0fcac6e0e6a10640">LineCoding</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#ac1183ac084bf32c8f54ecb1c24f0a4d1">CurrAddress</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html#a997cfdd9124b3e2f863a83f7f7d71c35">RunBootloader</a> = true</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Main source file for the CDC class bootloader. This file contains the complete bootloader logic. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a80f96189a34ca94c3f3a4b4e95f2aed3"></a><!-- doxytag: member="BootloaderCDC.c::INCLUDE_FROM_BOOTLOADERCDC_C" ref="a80f96189a34ca94c3f3a4b4e95f2aed3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INCLUDE_FROM_BOOTLOADERCDC_C</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a30b631d779b4fda01351df830602c146"></a><!-- doxytag: member="BootloaderCDC.c::CDC_Task" ref="a30b631d779b4fda01351df830602c146" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CDC_Task </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Task to read in AVR910 commands from the CDC data OUT endpoint, process them, perform the required actions and send the appropriate response back to the host. </p>

</div>
</div>
<a class="anchor" id="a953a275884b9e33629ff6323fca05252"></a><!-- doxytag: member="BootloaderCDC.c::EVENT_USB_Device_ConfigurationChanged" ref="a953a275884b9e33629ff6323fca05252" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EVENT_USB_Device_ConfigurationChanged </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Event handler for the USB_ConfigurationChanged event. This configures the device's endpoints ready to relay data to and from the attached USB host. </p>

</div>
</div>
<a class="anchor" id="abbebc3cb66ac3945b938ae5b93a71ea8"></a><!-- doxytag: member="BootloaderCDC.c::EVENT_USB_Device_UnhandledControlRequest" ref="abbebc3cb66ac3945b938ae5b93a71ea8" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EVENT_USB_Device_UnhandledControlRequest </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Event handler for the USB_UnhandledControlRequest event. This is used to catch standard and class specific control requests that are not handled internally by the USB library, so that they can be handled appropriately for the application. </p>

</div>
</div>
<a class="anchor" id="a31154d0202e81e96201b74ce3817a187"></a><!-- doxytag: member="BootloaderCDC.c::FetchNextCommandByte" ref="a31154d0202e81e96201b74ce3817a187" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static uint8_t FetchNextCommandByte </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Retrieves the next byte from the host in the CDC data OUT endpoint, and clears the endpoint bank if needed to allow reception of the next data packet from the host.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Next received byte from the host in the CDC data OUT endpoint </dd></dl>

</div>
</div>
<a class="anchor" id="a840291bc02cba5474a4cb46a9b9566fe"></a><!-- doxytag: member="BootloaderCDC.c::main" ref="a840291bc02cba5474a4cb46a9b9566fe" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Main program entry point. This routine configures the hardware required by the bootloader, then continuously runs the bootloader processing routine until instructed to soft-exit, or hard-reset via the watchdog to start the loaded application code. </p>

</div>
</div>
<a class="anchor" id="a544da7e0b12c53fa786563a27c993d2d"></a><!-- doxytag: member="BootloaderCDC.c::ReadWriteMemoryBlock" ref="a544da7e0b12c53fa786563a27c993d2d" args="(const uint8_t Command)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ReadWriteMemoryBlock </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&nbsp;</td>
          <td class="paramname"> <em>Command</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reads or writes a block of EEPROM or FLASH memory to or from the appropriate CDC data endpoint, depending on the AVR910 protocol command issued.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>Command</em>&nbsp;</td><td>Single character AVR910 protocol command indicating what memory operation to perform </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a5aa92c37b3202c4fa9e17b76cf72c9a7"></a><!-- doxytag: member="BootloaderCDC.c::ResetHardware" ref="a5aa92c37b3202c4fa9e17b76cf72c9a7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ResetHardware </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Resets all configured hardware required for the bootloader back to their original states. </p>

</div>
</div>
<a class="anchor" id="acb27e569c06a2797c5fd58ed39147448"></a><!-- doxytag: member="BootloaderCDC.c::SetupHardware" ref="acb27e569c06a2797c5fd58ed39147448" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetupHardware </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Configures all hardware required for the bootloader. </p>

</div>
</div>
<a class="anchor" id="a145c971e0691d08d5e8be6ceda7f20fd"></a><!-- doxytag: member="BootloaderCDC.c::WriteNextResponseByte" ref="a145c971e0691d08d5e8be6ceda7f20fd" args="(const uint8_t Response)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void WriteNextResponseByte </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&nbsp;</td>
          <td class="paramname"> <em>Response</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Writes the next response byte to the CDC data IN endpoint, and sends the endpoint back if needed to free up the bank when full ready for the next byte in the packet to the host.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>Response</em>&nbsp;</td><td>Next response byte to send to the host </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ac1183ac084bf32c8f54ecb1c24f0a4d1"></a><!-- doxytag: member="BootloaderCDC.c::CurrAddress" ref="ac1183ac084bf32c8f54ecb1c24f0a4d1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="a00003.html#ac1183ac084bf32c8f54ecb1c24f0a4d1">CurrAddress</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Current address counter. This stores the current address of the FLASH or EEPROM as set by the host, and is used when reading or writing to the AVRs memory (either FLASH or EEPROM depending on the issued command.) </p>

</div>
</div>
<a class="anchor" id="a95109883f628ac6b0fcac6e0e6a10640"></a><!-- doxytag: member="BootloaderCDC.c::LineCoding" ref="a95109883f628ac6b0fcac6e0e6a10640" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00001.html">CDC_Line_Coding_t</a> <a class="el" href="a00003.html#a95109883f628ac6b0fcac6e0e6a10640">LineCoding</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> { .BaudRateBPS = 9600,
                                 .CharFormat  = <a class="code" href="a00004.html#a7a9c6881ee9f7d324e97a315ae6f9aaca24f60cb3bc9b348b4ed57be8177e2bdd">OneStopBit</a>,
                                 .ParityType  = <a class="code" href="a00004.html#a1ecb87ec7431f5d2e59224135151d57da7f8793a77510c21effe0d26902630324">Parity_None</a>,
                                 .DataBits    = 8            }
</pre></div><p>Line coding options for the virtual serial port. Although the virtual serial port data is never sent through a physical serial port, the line encoding data must still be read and preserved from the host, or the host will detect a problem and fail to open the port. This structure contains the current encoding options, including baud rate, character format, parity mode and total number of bits in each data chunk. </p>

</div>
</div>
<a class="anchor" id="a997cfdd9124b3e2f863a83f7f7d71c35"></a><!-- doxytag: member="BootloaderCDC.c::RunBootloader" ref="a997cfdd9124b3e2f863a83f7f7d71c35" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="a00003.html#a997cfdd9124b3e2f863a83f7f7d71c35">RunBootloader</a> = true</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Flag to indicate if the bootloader should be running, or should exit and allow the application code to run via a soft reset. When cleared, the bootloader will abort, the USB interface will shut down and the application jumped to via an indirect jump to location 0x0000. </p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Dec 2009 for LUFA Library - CDC Class Bootloader by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
