<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LUFA (Formerly MyUSB) Library: Project Changelog</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="page_aboutlufa.html">About LUFA</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="Page_ChangeLog">Project Changelog </a></h1><h2><a class="anchor" id="Sec_ChangeLog091122">
Version 091122</a></h2>
<p><b>New:</b></p>
<ul>
<li>Added new Dual Role Keyboard/Mouse demo</li>
<li>Added new HID_HOST_BOOT_PROTOCOL_ONLY compile time token to reduce the size of the HID Host Class driver when Report protocol is not needed</li>
<li>Added new MIDI LowLevel and ClassDriver Host demo, add new MIDI Host Class driver</li>
<li>Added new CDC/Mouse ClassDriver device demo</li>
<li>Added new Joystick Host ClassDriver and LowLevel demos</li>
<li>Added new Printer Host mode Class driver</li>
<li>Added new Printer Host mode ClassDriver demo</li>
<li>Added optional support for double banked endpoints and pipes in the Device and Host mode Class drivers</li>
<li>Added new stream creation function to the CDC Class drivers, to easily make standard I/O streams from CDC Class driver instances</li>
</ul>
<p><b>Changed:</b></p>
<ul>
<li>Removed mostly useless "TestApp" demo, as it was mainly useful only for checking for sytax errors in the library</li>
<li>MIDI device demos now receive MIDI events from the host and display note ON messages via the board LEDs</li>
<li>Cleanups to the Device mode Mass Storage demo application SCSI routines</li>
<li>Changed Audio Class driver sample read/write functions to be inline, to reduce the number of cycles needed to transfer samples to and from the device (allowing more time for sample processing and output)</li>
<li>Audio class Device mode demos now work at both 16MHz and 8MHz, rather than just at 8MHz</li>
<li>The previous USBtoSerial demo has been moved into the projects directory, as it was just a modified CDC demo</li>
<li>The Endpoint/Pipe functions now use the const qualifier on the input buffer</li>
<li>Changed the <a class="el" href="a00245.html#gafa347c80d225c0b593b26010c9d48256">CALLBACK_HIDParser_FilterHIDReportItem()</a> callback to pass a <a class="el" href="a00006.html">HID_ReportItem_t</a> rather than just the current item's attributes, to expose more information on the item (including it's type, collection path, etc.)</li>
<li>Changed MouseHostWithParser demos to check that the report items have a Mouse usage collection as a parent at some point, to prevent Joysticks from enumerating with the demo</li>
<li>Corrected the name of the misnamed USB_GetDeviceConfigDescriptor() function to <a class="el" href="a00256.html#gacb936f8021d9ec7f59b5e8dbea6314c4">USB_Host_GetDeviceConfigDescriptor()</a>.</li>
<li>Keyboard LowLevel/ClassDriver demos now support multiple simultaneous keypresses (up to 6) per report</li>
</ul>
<p><b>Fixed:</b></p>
<ul>
<li>Fixed PrinterHost demo returning invalid Device ID data when the attached device does not have a device ID (thanks to Andrei Krainev)</li>
<li>Changed LUFA_VERSION_INTEGER define to use BCD values, to make comparisons eaiser</li>
<li>Fixed issue in the HID Host class driver's <a class="el" href="a00244.html#ga17e5c3d30dd4c5cc2747567c23ca1bef">HID_Host_SendReportByID()</a> routine using the incorrect mode (control/pipe) to send report to the attached device</li>
<li>Fixed ClassDriver AudioOutput device demo not selecting an audio output mode</li>
<li>Fixed incorrect SampleFrequencyType value in the AudioInput and AudioOutput ClassDriver demos' descriptors</li>
<li>Fixed incorrect event name rule in demo/project/bootloader makefiles</li>
<li>Fixed HID device class driver not reselecting the correct endpoint once the user callback routines have been called</li>
<li>Corrected HID descriptor in the Joystick Device demos - buttons should be placed outside the pointer collection</li>
<li>Fixed HID report parser collection paths invalid due to misplaced semicolon in the free path item search loop</li>
<li>Fixed HID host Class driver report send/receive report broken when issued through the control pipe</li>
<li>Fixed HOST_STATE_AS_GPIOR compile time option being ignored when in host mode (thanks to David Lyons)</li>
<li>Fixed LowLevel Keyboard demo not saving the issues report only after it has been sent to the host</li>
<li>Fixed Endpoint_Write_Control_Stream_* functions not sending a terminating IN when given data Length is zero</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog090924">
Version 090924</a></h2>
<p><b>New:</b></p>
<ul>
<li>Added new host mode class drivers and matching demos to the library for rapid application development</li>
<li>Added flag to the HID report parser to indicate if a device has multiple reports</li>
<li>Added new <a class="el" href="a00257.html#gaa3ebb4fd4403f463b300b745d8485b65">EVENT_USB_Device_StartOfFrame()</a> event, controlled by the new <a class="el" href="a00261.html#gac66960e9df5ebd24a4a83fcfb2d5d16f">USB_Device_EnableSOFEvents()</a> and <a class="el" href="a00261.html#ga3d228b1f65da7c37bd968c482ffd487d">USB_Device_DisableSOFEvents()</a> macros to give bus-synchronised millisecond interrupts when in USB device mode</li>
<li>Added new <a class="el" href="a00262.html#ga73e11a37553269715f5f0011ea7392d6">Endpoint_SetEndpointDirection()</a> macro for bidirectional endpoints</li>
<li>Added new AVRISP project, a LUFA powered clone of the Atmel AVRISP-MKII programmer</li>
<li>Added ShutDown() functions for all hardware peripheral drivers, so that peripherals can be turned off after use</li>
<li>Added new <a class="el" href="a00237.html#gaeb9d2f95c40e99dd8c6dc1ad30a47485">CDC_Device_Flush()</a> command to the device mode CDC Class driver to flush Device-&gt;Host data</li>
<li>Added extra masks to the SPI driver, changed <a class="el" href="a00225.html#ga4f3df1f409a3314926693aaf83e02ff1">SPI_Init()</a> so that the clock polarity and sample modes can be set</li>
<li>Added new callback to the HID report parser, so that the user application can filter only the items it is interested in to be stored into the HIDReportInfo structure to save RAM</li>
<li>Added support for the officially recommended external peripheral layout for the BUMBLEB board (thanks to Dave Fletcher)</li>
<li>Added new <a class="el" href="a00270.html#ga9c5ec9569874b997b5f30365b46e93a2">Pipe_IsFrozen()</a> macro to determine if the currently selected pipe is frozen</li>
<li>Added new <a class="el" href="a00245.html#gab2faafc4da2a36a31966e50ec9c35f33">USB_GetHIDReportSize()</a> function to the HID report parser to retrieve the size of a given report by its ID</li>
<li>Added new combined Mass Storage and Keyboard demo (thanks to Matthias Hullin)</li>
</ul>
<p><b>Changed:</b></p>
<ul>
<li>SetIdle requests to the HID device driver with a 0 idle period (send changes only) now only affect the requested HID interface within the device, not all HID interfaces</li>
<li>Added explicit attribute masks to the device mode demos' descriptors</li>
<li>Added return values to the CDC and MIDI class driver transmit functions</li>
<li>Optimized Endpoint_Read_Word_* and Pipe_Read_Word_* macros to reduce compiled size</li>
<li>Added non-null function parameter pointer restrictions to USB Class drivers to improve user code reliability</li>
<li>Added new "Common" section to the class drivers, to hold all mode-independant definitions for clarity</li>
<li>Moved SCSI command/sense constants into the Mass Storage Class driver, instead of the user-code</li>
<li>Altered the SCSI commands in the LowLevel Mass Storage Host to save on FLASH space by reducing function calls</li>
<li>Changed the parameters and behaviour of the USB_GetDeviceConfigDescriptor() function so that it now performs size checks and data validations internally, to simplify user code</li>
<li>Changed HIDParser to only zero out important values in the Parsed HID Report Item Information structure to save cycles</li>
<li>The HID report parser now always processed FEATURE items - HID_ENABLE_FEATURE_PROCESSING token now has no effect</li>
<li>The HID report parser now always ignores constant-data items, HID_INCLUDE_CONSTANT_DATA_ITEMS token now has no effect</li>
<li>The Benito Programmer project now has its own unique VID/PID pair allocated from the Atmel donated LUFA VID/PID pool</li>
<li>Add in new invalid event hook check targets to project makefiles to produce compilation errors when invalid event names are used in a project</li>
<li>The HID Report Parser now gives information on the total length of each report within a HID interface</li>
<li>The USE_NONSTANDARD_DESCRIPTOR_NAMES compile time token has been removed - there are now seperate USB_Descriptor_* and USB_StdDescriptor_* structures for both the LUFA and standardized element naming conventions so both may be used</li>
</ul>
<p><b>Fixed:</b></p>
<ul>
<li>Fixed possible lockup in the CDC device class driver, when the host sends data that is a multiple of the endpoint's bank</li>
<li>Fixed swapped parameters in the HID state memory copy call while processing a HID PUSH item in the HID report parser</li>
<li>Fixed memory corruption HID report parser when too many COLLECTION or PUSH items were processed</li>
<li>Fixed HID report parser not resetting the FEATURE item count when a REPORT ID item is encountered</li>
<li>Fixed USBtoSerial demos not reading in UDR1 when the USART receives data but the USB interface is not enumerated, causing continuous USART receive interrupts</li>
<li>Fixed misspelt event name in the Class driver USBtoSerial demo, preventing correct operation</li>
<li>Fixed invalid data being returned when a GetStatus request is issued in Device mode with an unhandled data recipient</li>
<li>Added hardware USART receive interrupt and software buffering to the Benito project to ensure received data is not missed or corrupted</li>
<li>Fixed Device mode HID Class driver always sending IN packets, even when nothing to report</li>
<li>Fixed Device mode HID Class driver not explicitly initializing the ReportSize parameter to zero before calling callback routine, so that ignored callbacks don't cause incorrect data to be sent</li>
<li>Fixed StillImageHost not correctly freezing and unfreezing data pipes while waiting for a response block header</li>
<li>Fixed error in the PrinterHost demo preventing the full page data from being sent to the attached device (thanks to John Andrews)</li>
<li>Fixed CDC based demos and projects' INF driver files under 64 bit versions of Windows (thanks to Ronny Hanson, Thomas Bleeker)</li>
<li>Re-add in missing flip, flip-ee, dfu and dfu-ee targets to project makefiles (thanks to Opendous Inc.)</li>
<li>Fix allowable F_CPU values comment in project makefiles to more accurately reflect the allowable values on the USB AVRs</li>
<li>Fixed DFU and CDC class bootloaders on the series 2 USB AVRs, corrected invalid signatures, added support for the new ATMEGAxx2 series 2 variant AVRs to the DFU bootloader</li>
<li>Fixed Low Level USBtoSerial demo not storing received characters (thanks to Michael Cooper)</li>
<li>Fixed MIDI Device Class driver not sending/receiving MIDI packets of the correct size (thanks to Thomas Bleeker)</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog090810">
Version 090810</a></h2>
<p><b>New:</b></p>
<ul>
<li>Added new device class drivers and matching demos to the library for rapid application development</li>
<li>Added new PrinterHost demo (thanks to John Andrews)</li>
<li>Added USB Missle Launcher project, submitted by Dave Fletcher</li>
<li>Added new Benito Arduino Programmer project</li>
<li>Added incomplete device and host mode demos for later enhancement</li>
<li>Updated MassStorage device block write routines to use ping-pong Dataflash buffering to increase throughput by around 30%</li>
<li>Error status LEDs shown when device endpoint configuration fails to complete in all demos and projects</li>
<li>Added new <a class="el" href="a00267.html#ga089d8d7a9b075118ce6b070667e4c89f">USB_Host_SetDeviceConfiguration()</a> convenience function for easy configuration selection of devices while in USB host mode</li>
<li>Added new <a class="el" href="a00267.html#ga1b0271f4b5e0e0829f091567005d8fb8">USB_Host_ClearPipeStall()</a> convenience function to clear a stall condition on an attached device's endpoint</li>
<li>Added new <a class="el" href="a00267.html#gaab5464d90f1c6cd750f977b631d0bbf1">USB_Host_GetDeviceDescriptor()</a> convenience function to retrieve the attached device's Device descriptor</li>
<li>Added new <a class="el" href="a00262.html#ga9e00020d1fca630c351e3b8139ba67df">Endpoint_ClearStatusStage()</a> convenience function to assist with the status stages of control transfers</li>
<li>Added new USE_INTERNAL_SERIAL define for using the unique serial numbers in some AVR models as the USB device's serial number, added NO_INTERNAL_SERIAL compile time option to turn off new serial number reading code</li>
<li>Added new <a class="el" href="a00199.html#ga139827baac789e7383e37756c78a4074">DATAFLASH_CHIP_MASK()</a> macro to the Dataflash driver, which returns the Dataflash select mask for the given chip index</li>
<li>Added new HOST_STATE_WaitForDeviceRemoval host state machine state for non-blocking disabling of device communications until the device has been removed (for use when an error occurs or communications with the device have completed)</li>
<li>Added new FAST_STREAM_TRANSFERS compile time option for faster stream transfers via multiple bytes copied per stream loop</li>
<li>Added stdio stream demo code to the CDC device demos, to show how to create standard streams out of the virtual serial ports</li>
<li>Added new EEPROM and FLASH buffer versions of the Endpoint and Pipe stream functions</li>
<li>Added new USE_FLASH_DESCRIPTORS and FIXED_NUM_CONFIGURATIONS compile time options</li>
<li>Added support for the new ATMEGA32U2, ATMEGA16U2 and ATMEGA8U2 AVR models</li>
<li>Added new USB_DeviceState variable to keep track of the current Device mode USB state</li>
<li>Added new <a class="el" href="a00201.html#ga652d4b72129873e3b095a88180df72a9">LEDs_ToggleLEDs()</a> function to the LEDs driver</li>
<li>Added new <a class="el" href="a00270.html#ga185444719aee80fcd0177b5902052bd9">Pipe_BoundEndpointNumber()</a> and <a class="el" href="a00270.html#ga51c73bb3b527af06f6371fc68ff817b0">Pipe_IsEndpointBound()</a> functions</li>
<li>Added new DEVICE_STATE_AS_GPIOR and HOST_STATE_AS_GPIOR compile time options</li>
<li>Added 404 Not Found errors to the webserver in the RNDIS demos to indicate invalid URLs</li>
</ul>
<p><b>Changed:</b></p>
<ul>
<li>Deprecated psuedo-scheduler and removed dynamic memory allocator from the library (first no longer needed and second unused)</li>
<li>The device-mode <a class="el" href="a00261.html#ga3ddb91eff57e62010de59db65e51b087">CALLBACK_USB_GetDescriptor()</a> function now has an extra parameter so that the memory space in which the requested descriptor is located can be specified. This means that descriptors can now be located in multiple memory spaces within a device.</li>
<li>Removed vague USB_IsConnected global - test USB_DeviceState or USB_HostState explicitly to gain previous functionality</li>
<li>Removed USB_IsSuspended global - test USB_DeviceState against DEVICE_STATE_Suspended instead</li>
<li>Extended USB_GetDeviceConfigDescriptor() routine to require the configuration number within the device to fetch</li>
<li><a class="el" href="a00199.html#gaa1e6400832a3496234852e77643ba9d3">Dataflash_WaitWhileBusy()</a> now always ensures that the dataflash is ready for the next command immediately after returning, no need to call <a class="el" href="a00199.html#gabda610d1e72b182b238a3c871fecd9b9">Dataflash_ToggleSelectedChipCS()</a> afterwards</li>
<li>Low level API MIDI device demo no longer blocks if a note change event is sent while the endpoint is not ready</li>
<li><a class="el" href="a00270.html#ga42f0d36f0f2bb2df166c5e88c92f95e4">Pipe_GetErrorFlags()</a> now returns additional error flags for overflow and underflow errors</li>
<li>Pipe stream functions now automatically set the correct pipe token, so that bidirectional pipes can be used</li>
<li><a class="el" href="a00270.html#ga2bb8e356f6181ca9e2c1cab2041388d0">Pipe_ConfigurePipe()</a> now automatically defaults IN pipes to accepting infinite IN requests, this can still be changed by calling the existing <a class="el" href="a00270.html#ga3ed738d343dc1dbf235195929821cec6">Pipe_SetFiniteINRequests()</a> function</li>
<li>Changed F_CLOCK entries in project makefiles to alias to F_CPU by default, as this is the most common case</li>
<li>Host mode demos now use sane terminal escape codes, so that text is always readable and events/program output is visually distinguished from oneanother using foreground colours</li>
<li>Internal per-device preprocessing conditions changed to per-device series rather than per-controller group for finer-grain internal control</li>
<li>Interrupts are no longer disabled during the processing of Control Requests on the default endpoint while in device mode</li>
<li>AudioOutput demos now always output to board LEDs, regardless of output mode (removed AUDIO_OUT_LEDS project option)</li>
<li>Removed SINGLE_DEVICE_CONFIGURATION compile time option in favour of the new FIXED_NUM_CONFIGURATIONS option so that the exact number of device configurations can be defined statically</li>
<li>Removed VBUS events, as they are already exposed to the user application via the regular device connection and disconnection events</li>
<li>Renamed and altered existing events to properly seperate out Host and Device mode events</li>
</ul>
<p><b>Fixed:</b></p>
<ul>
<li>Changed bootloaders to use FLASHEND rather than the existence of RAMPZ to determine if far FLASH pointers are needed to fix bootloaders on some of the USB AVR devices where avr-libc erronously defines RAMPZ</li>
<li>Fixes to MassStorageHost for better device compatibility (increase command timeout, change MassStore_WaitForDataReceived() to only unfreeze and check one data pipe at a time) to prevent incorrect device enumerations and freezes while trasferring data</li>
<li>Make <a class="el" href="a00270.html#ga2bb8e356f6181ca9e2c1cab2041388d0">Pipe_ConfigurePipe()</a> mask the given endpoint number against PIPE_EPNUM_MASK to ensure the endpoint IN direction bit is cleared to prevent endpoint type corruption</li>
<li>Fixed issue opening CDC-ACM ports on hosts when the CDC device tries to send data before the host has set the line encoding</li>
<li>Fixed USB_OPT_MANUAL_PLL option being ignored during device disconnects on some models (thanks to Brian Dickman)</li>
<li>Fixed documentation mentioning Pipe_GetCurrentToken() function when correct function name is <a class="el" href="a00270.html#ga28b2198fd9796beb18a7aad38483b83e">Pipe_GetPipeToken()</a></li>
<li>Fixed ADC driver for the ATMEGA32U4 and ATMEGA16U4 (thanks to Opendous Inc.)</li>
<li>Fixed CDCHost demo unfreezing the pipes at the point of configuration, rather than use</li>
<li>Fixed MassStorage demo not clearing the reset flag when a Mass Storage Reset is issued while not processing a command</li>
<li>Fixed <a class="el" href="a00275.html#gaf45823f32ea2880ecf62ffacacdbdc98">USB_Host_SendControlRequest()</a> not re-suspending the USB bus when initial device ready-wait fails</li>
<li>Fixed USB Pad regulator not being disabled on some AVR models when the USB_OPT_REG_DISABLED option is used</li>
<li>Fixed Host mode to Device mode UID change not causing a USB Disconnect event when a device was connected</li>
<li>Fixed Mouse/Keyboard demos not performing the correct arithmetic on the Idle period at the right times (thanks to Brian Dickman)</li>
<li>Fixed GenericHID failing HID class tests due to incorrect Logical Minimum and Logical Maximum values (thanks to Søren Greiner)</li>
<li>Fixed incorrect PIPE_EPNUM_MASK mask causing pipe failures on devices with endpoint addresses of 8 and above (thanks to John Andrews)</li>
<li>Fixed report data alignment issues in the MouseHostWithParser demo when X and Y movement data size is not a multiple of 8 bits</li>
<li>Fixed HID Report Descriptor Parser not correctly resetting internal states when a REPORT ID element is encountered</li>
<li>Fixed incorrect BUTTONS_BUTTON1 for the STK526 target</li>
<li>Fixed RNDIS demos freezing when more than one connection was attempted simultaneously, causing memory corruption</li>
<li>Fixed USBtoSerial demo receiving noise from the USART due to pullup not being enabled</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog090605">
Version 090605</a></h2>
<ul>
<li>Fixed bug in RNDISEthernet and DualCDC demos not using the correct USB_ControlRequest structure for control request data</li>
<li>Fixed documentation showing incorrect USB mode support on the supported AVRs list</li>
<li>Fixed RNDISEthernet not working under Linux due to Linux requiring an "optional" RNDIS request which was unhandled</li>
<li>Fixed Mouse and Keyboard device demos not acting in accordance with the HID specification for idle periods (thanks to Brian Dickman)</li>
<li>Removed support for endpoint/pipe non-control interrupts; these did not act in the way users expected, and had many subtle issues</li>
<li>Fixed Device Mode not handling Set Feature and Clear Feature Chapter 9 requests that are addressed to the device (thanks to Brian Dickman)</li>
<li>Moved control endpoint interrupt handling into the library itself, enable via the new INTERRUPT_CONTROL_ENDPOINT token</li>
<li>Fixed CDCHost not clearing configured pipes and resetting configured pipes mask when a partially enumerated invalid CDC interface is skipped</li>
<li>Clarified the size of library tokens which accept integer values in the Compile Time Tokens page, values now use the smallest datatype inside the library that is able to hold their defined value to save space</li>
<li>Removed DESCRIPTOR_ADDRESS() macro as it was largely supurflous and only served to obfuscate code</li>
<li>Rewritten event system to remove all macros, to make user code clearer</li>
<li>Fixed incorrect ENDPOINT_EPNUM_MASK mask preventing endpoints above EP3 from being selected (thanks to Jonathan Oakley)</li>
<li>Removed STREAM_CALLBACK() macro - callbacks now use regular function definitions to clarify user code</li>
<li>Removed DESCRIPTOR_COMPARATOR() macro - comparators should now use regular function definitions to clarify user code</li>
<li>USB_IsConnected is now cleared before the USB_Disconnect() event is fired in response to VBUS being removed</li>
<li>Fixed incorrect PID value being used in the USBtoSerial project (thanks to Phill)</li>
<li>Deleted StdDescriptors.c, renamed USB_GetDescriptor() to CALLBACK_USB_GetDescriptor, moved ConfigDescriptor.c/.h from the LUFA/Drivers/USB/Class/ directory to LUFA/Drivers/USB/HighLevel/ in preperation for the new USB class APIs</li>
<li>Moved out each demos' functionality library files (e.g. Ring Buffer library) to /Lib directories for a better directory structure</li>
<li>Removed Tx interrupt from the USBtoSerial demo; now sends characters via polling to ensure more time for the Rx interrupt</li>
<li>Fixed possible enumeration errors from spinloops which may fail to exit if the USB connection is severed before the exit condition becomes true</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog090510">
Version 090510</a></h2>
<ul>
<li>Added new GenericHIDHost demo</li>
<li>Corrections to the KeyboardHost and MouseHost demos' pipe handling to freeze and unfreeze the data pipes at the point of use</li>
<li>KeyboardHost, MouseHost and GenericHIDHost demos now save and restore the currently selected pipe inside the pipe ISR</li>
<li>Changed GenericHID device demo to use the LUFA scheduler, added INTERRUPT_DATA_ENDPOINT and INTERRUPT_CONTROL_ENDPOINT compile time options</li>
<li>All comments in the library, bootloaders, demos and projects have now been spell-checked and spelling mistakes/typos corrected</li>
<li>Added new <a class="el" href="a00235.html#ga662d95ca139c3842ca5d2769d44bed07">PIMA_DATA_SIZE()</a> define to the Still Image Host demo</li>
<li>Add call to MassStore_WaitForDataReceived() in MassStore_GetReturnedStatus() to ensure that the CSW has been received in the extended MSC timeout period before continuing, to prevent long processing delays from causing the MassStore_GetReturnedStatus() to early-abort (thanks to Dmitry Maksimov)</li>
<li>Move <a class="el" href="a00147.html">StdRequestType.h</a>, <a class="el" href="a00148.html">StreamCallbacks.h</a>, <a class="el" href="a00150.html">USBMode.h</a> from the LowLevel USB driver directory to the HighLevel USB driver directory, where they are more suited</li>
<li>Removed all binary constants and replaced with decimal or hexadecimal constants so that unpatched GCC compilers can still build the code without having to be itself patched and recompiled first</li>
<li>Added preprocessor checks and documentation to the bootloaders giving information about missing SIGNATURE_x defines due to outdated avr-libc versions.</li>
<li>Added support to the CDCHost demo for devices with multiple CDC interfaces which are not the correct ACM type preceding the desired ACM CDC interface</li>
<li>Fixed GenericHID demo not starting USB and HID management tasks when not using interrupt driven modes (thanks to Carl Kjeldsen)</li>
<li>Fixed RNDISEthenet demo checking the incorrect message field for packet size constraints (thanks to Jonathan Oakley)</li>
<li>Fixed WriteNextReport code in the GenericHIDHost demo using incorrect parameter types and not selecting the correct endpoint</li>
<li>Adjusted sample CTC timer calculations in the AudioOutput and AudioInput demos to match the CTC calculations in the AVR datasheet, and to fix instances where rounding caused the endpoint to underflow (thanks to Robin Theunis)</li>
<li>The <a class="el" href="a00275.html#gaf45823f32ea2880ecf62ffacacdbdc98">USB_Host_SendControlRequest()</a> function no longer automatically selects the Control pipe (pipe 0), so that other control type pipes can be used with the function</li>
<li>The USB Host management task now saves and restores the currently selected pipe before and after the task completes</li>
<li>Fixed GenericHIDHost demo report write routine incorrect for control type requests (thanks to Andrei Krainev)</li>
<li>Removed Endpoint_ClearCurrentBank() and Pipe_ClearCurrentBank() in favour of new <a class="el" href="a00266.html#ga7a18211c2800d663a4ef99b5da8f1483">Endpoint_ClearIN()</a>, <a class="el" href="a00266.html#ga3e46b62f81211da48ab96d4d1183855f">Endpoint_ClearOUT()</a>, <a class="el" href="a00274.html#gaaf4af52725c374e7a0f8c83c761ea8b0">Pipe_ClearIN()</a> and <a class="el" href="a00274.html#gae8ce37aaba46769e2f908fb25370f3f5">Pipe_ClearOUT()</a> macros (done to allow for the detection of packets of zero length)</li>
<li>Renamed *_ReadWriteAllowed() macros to *_IsReadWriteAllowed() to remain consistent with the rest of the LUFA API</li>
<li>Endpoint_IsSetupReceived() macro has been renamed to <a class="el" href="a00266.html#gaa0cd742116651fdc71c63be76f8eee7f">Endpoint_IsSETUPReceived()</a>, Endpoint_ClearSetupReceived() macro has been renamed to <a class="el" href="a00266.html#ga5cb175c6c0f6f8777fbc21e6f2016a72">Endpoint_ClearSETUP()</a>, the Pipe_IsSetupSent() macro has been renamed to <a class="el" href="a00274.html#ga585169719c466525956861db62a56143">Pipe_IsSETUPSent()</a> and the Pipe_ClearSetupSent() macro is no longer applicable and should be removed - changes made to compliment the new endpoint and pipe bank management API</li>
<li>Updated all demos, bootloaders and projects to use the new endpoint and pipe management APIs (thanks to Roman Thiel from Curetis AG)</li>
<li>Updated library doxygen documentation, added groups, changed documentation macro functions to real functions for clarity</li>
<li>Removed old endpoint and pipe aliased read/write/discard routines which did not have an explicit endian specifier for clarity</li>
<li>Removed the ButtLoadTag.h header file, as no one used for its intended purpose anyway</li>
<li>Renamed the main Drivers/AT90USBXXX directory to Drivers/Peripheral, renamed the Serial_Stream driver to SerialStream</li>
<li>Fixed CDC and USBtoSerial demos freezing where buffers were full while still transmitting or receiving (thanks to Peter Hand)</li>
<li>Removed "Host_" section of the function names in <a class="el" href="a00144.html">ConfigDescriptor.h</a>, as most of the routines can now be used in device mode on the device descriptor</li>
<li>Renamed functions in the HID parser to have a "USB_" prefix and the acronym "HID" in the name</li>
<li>Fixed incorrect HID interface class and subclass values in the Mouse and KeyboardMouse demos (thanks to Brian Dickman)</li>
<li>Capitalised the "Descriptor_Search" and "Descriptor_Search_Comp" prefixes of the values in the DSearch_Return_ErrorCodes_t and DSearch_Comp_Return_ErrorCodes_t enums</li>
<li>Removed "ERROR" from the enum names in the endpoint and pipe stream error code enums</li>
<li>Renamed the USB_PowerOnErrorCodes_t enum to USB_InitErrorCodes_t, renamed the POWERON_ERROR_NoUSBModeSpecified enum value to USB_INITERROR_NoUSBModeSpecified</li>
<li>Renamed USB_PowerOnFail event to USB_InitFailure</li>
<li>Renamed <a class="el" href="a00158.html">OTG.h</a> header functions to be more consistent with the rest of the library API</li>
<li>Changed over all deprecated GCC structure tag initializers to the standardized C99 format (thanks to Mike Alexander)</li>
<li>USB_HostRequest renamed to USB_ControlRequest, entire control request header is now read into USB_ControlRequest in Device mode rather than having the library pass only partially read header data to the application</li>
<li>The USB_UnhandledControlPacket event has had its parameters removed, in favour of accessing the new USB_ControlRequest structure</li>
<li>The Endpoint control stream functions now correctly send a ZLP to the host when less data than requested is sent</li>
<li>Fixed USB_RemoteWakeupEnabled flag never being set (the REMOTE WAKEUP Set Feature request was not being handled)</li>
<li>Renamed the FEATURELESS_CONTROL_ONLY_DEVICE compile-time token to CONTROL_ONLY_DEVICE</li>
<li>Endpoint configuration is now refined to give better output when all configurations have static inputs - removed the now useless STATIC_ENDPOINT_CONFIGURATION compile time token</li>
<li>Fixed SPI driver init function not clearing SPI2X bit when not needed</li>
<li>Fixed PREVENT ALLOW MEDIUM REMOVAL command issuing in the MassStorageHost demo using incorrect parameters (thanks to Mike Alex)</li>
<li>Fixed MassStorageHost demo broken due to an incorrect if statement test in MassStore_GetReturnedStatus()</li>
<li>Fixed reversed signature byte ordering in the CDC bootloader (thanks to Johannes Raschke)</li>
<li>Changed PIPE_CONTROLPIPE_DEFAULT_SIZE from 8 to 64 to try to prevent problems with faulty devices which do not respect the given wLength value when reading in the device descriptor</li>
<li>Fixed missing semicolon in the ATAVRUSBRF01 LED board driver code (thanks to Morten Lund)</li>
<li>Changed LED board driver code to define dummy LED masks for the first four board LEDs, so that user code can be compiled for boards with less than four LEDs without code modifications (thanks to Morten Lund)</li>
<li>Changed HWB board driver to Buttons driver, to allow for the support of future boards with more than one mounted GPIO button</li>
<li>Serial driver now correctly calculates the baud register value when in double speed mode</li>
<li>Init function of the Serial driver is now static inline to product smaller code for the common-case of static init values</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog090401">
Version 090401</a></h2>
<ul>
<li>Fixed MagStripe project configuration descriptor containing an unused (blank) endpoint descriptor</li>
<li>Incorporated makefile changes by Denver Gingerich to retain compatibility with stock (non-WinAVR) AVR-GCC installations</li>
<li>Fixed makefile EEPROM programming targets programming FLASH data in addition to EEPROM data</li>
<li>LUFA devices now enumerate correctly with LUFA hosts</li>
<li>Fixed Configuration Descriptor search routine freezing when a comparator returned a failure</li>
<li>Removed HID report item serial dump in the MouseHostWithParser and KeyboardHostWithParser - useful only for debugging, and slowed down the enumeration of HID devices too much</li>
<li>Increased the number of bits per track which can be read in the MagStripe project to 8192 when compiled for the AT90USBXXX6/7</li>
<li>Fixed KeyboardMouse demo discarding the wIndex value in the REQ_GetReport request</li>
<li>USBtoSerial demo now discards all Rx data when not connected to a USB host, rather than buffering characters for transmission next time the device is attached to a host.</li>
<li>Added new F_CLOCK compile time constant to the library and makefiles, to give the raw input clock (used to feed the PLL before any clock prescaling is performed) frequency, so that the PLL prescale mask can be determined</li>
<li>Changed stream wait timeout counter to be 16-bit, so that very long timeout periods can be set for correct communications with badly designed hosts or devices which greatly exceed the USB specification limits</li>
<li>Mass Storage Host demo now uses a USB_STREAM_TIMEOUT_MS of two seconds to maintain compatibility with poorly designed devices</li>
<li>Function attribute ATTR_ALWAYSINLINE renamed to ATTR_ALWAYS_INLINE to match other function attribute macro naming conventions</li>
<li>Added ATTR_ALWAYS_INLINE attribute to several key inlined library components, to ensure they are inlined in all circumstances</li>
<li>Removed SetSystemClockPrescaler() macro, the clock_prescale_set() avr-libc macro has been corrected in recent avr-libc versions</li>
<li>Fixed incorrect/missing control status stage transfers on demos, bootloaders and applications (thanks to Nate Lawson)</li>
<li>The NO_CLEARSET_FEATURE_REQUEST compile time token has been renamed to FEATURELESS_CONTROL_ONLY_DEVICE, and its function expanded to also remove parts of the Get Status chapter 9 request to further reduce code usage</li>
<li>Makefile updated to include output giving the currently selected BOARD parameter value</li>
<li>Board Dataflash driver now allows for dataflash ICs which use different shifts for setting the current page/byte address (thanks to Kenneth Clubb)</li>
<li>Added DataflashManager_WriteBlocks_RAM() and DataflashManager_ReadBlocks_RAM() functions to the MassStorage demo, to allow for easy interfacing with a FAT library for dataflash file level access</li>
<li>Corrected CDC class bootloader to fix a few bugs, changed address counter to store x2 addresses for convenience</li>
<li>Fixed typos in the SPI driver SPI_SPEED_FCPU_DIV_64 and SPI_SPEED_FCPU_DIV_128 masks (thanks to Markus Zocholl)</li>
<li>Keyboard and Mouse device demos (normal, data interrupt and fully interrupt driven) combined into unified keyboard and mouse demos</li>
<li>Keyboard and Mouse host demos (normal and data interrupt driven) combined into unified keyboard and mouse demos</li>
<li>Removed AVRISP_Programmer project due to code quality concerns</li>
<li>Fixed CDC demo not sending an empty packet after each transfer to prevent the host from buffering incoming data</li>
<li>Fixed documentation typos and preprocessor checks relating to misspellings of the USE_RAM_DESCRIPTORS token (thanks to Ian Gregg)</li>
<li>Fixed <a class="el" href="a00151.html">USBTask.h</a> not conditionally including <a class="el" href="a00156.html">HostChapter9.h</a> only when USB_CAN_BE_HOST is defined (thanks to Ian Gregg)</li>
<li>Fixed incorrect ADC driver init register manipulation (thanks to Tobias)</li>
<li>Added new GenericHID device demo application</li>
<li>Fixed Still Image Host SImage_SendData() function not clearing the pipe bank after sending data</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog090209">
Version 090209</a></h2>
<ul>
<li>PWM timer mode in AudioOut demo changed to Fast PWM for speed</li>
<li>Updated Magstripe project to work with the latest hardware revision</li>
<li>Fixed library not responding to the BCERRI flag correctly in host mode, leading to device lockups</li>
<li>Fixed library handling Get Descriptor requests when not addressed as standard requests to the device or interface (thanks to Nate Lawson)</li>
<li>Fixed serious data corruption issue in MassStorage demo dataflash write routine</li>
<li>Added new NO_CLEARSET_FEATURE_REQUEST compile time token</li>
<li>USB task now restores previous global interrupt state after execution, rather than forcing global interrupts to be enabled</li>
<li>Fixed USB_DeviceEnumerationComplete event firing after each configuration change, rather than once after the initial configuration</li>
<li>Added <a class="el" href="a00262.html#ga94e28d8a057800482e42435807ad9c16">ENDPOINT_DOUBLEBANK_SUPPORTED()</a> macros to <a class="el" href="a00154.html">Endpoint.h</a>, altered <a class="el" href="a00262.html#gacf9fb35663717d6cdf4edd73d33893dd">ENDPOINT_MAX_SIZE()</a> to allow user to specify endpoint</li>
<li>ENDPOINT_MAX_ENDPOINTS changed to ENDPOINT_TOTAL_ENDPOINTS, PIPE_MAX_PIPES changed to PIPE_TOTAL_PIPES</li>
<li>Endpoint and Pipe non-control stream functions now ensure endpoint or pipe is ready before reading or writing</li>
<li>Changed Teensy bootloader to use a watchdog reset when exiting rather than a software jump</li>
<li>Fixed integer promotion error in MassStorage and MassStorageHost demos, corrupting read/write transfers</li>
<li>SPI_SendByte is now SPI_TransferByte, added new SPI_SendByte and SPI_ReceiveByte functions for fast one-way transfer</li>
<li>MassStorage demo changed to use new fast one-way SPI transfers to increase throughput</li>
<li>MassStorage handling of Mass Storage Reset class request improved</li>
<li>Altered MassStorage demo dataflash block read code for speed</li>
<li>Added USB_IsSuspended global flag</li>
<li>Simplified internal Dual Mode (OTG) USB library code to reduce code size</li>
<li>Extended stream timeout period to 100ms from 50ms</li>
<li>Mass Storage Host demo commands now all return an error code from the Pipe_Stream_RW_ErrorCodes_t enum</li>
<li>Added SubErrorCode parameter to the USB_DeviceEnumerationFailed event</li>
<li>VBUS drop interrupt now disabled during the manual-to-auto VBUS delivery handoff</li>
<li>Simplified low level backend so that device/host mode initialization uses the same code paths</li>
<li>Added workaround for faulty Mass Storage devices which do not implement the required GET_MAX_LUN request</li>
<li>Removed buggy Telnet application from the RNDIS demo</li>
<li>Moved Mass Storage class requests in the Mass Storage Host demo to wrapper functions in MassStoreCommands.c</li>
<li>Fixed incorrect SCSI command size value in the Request Sense command in MassStoreCommands.c</li>
<li>Added SetProtocol request to HID class non-parser Mouse and Keyboard demos to force devices to use the correct Boot Protocol</li>
<li>Added new "dfu" and "flip" programming targets to project makefiles</li>
<li>HID_PARSE_Sucessful enum member typo corrected to HID_PARSE_Successful</li>
<li>Changed COLLECTION item structures in the HID descriptor parser to include the collection's Usage Page value</li>
<li>Serial driver now sets Tx line as output, enables pullup on Rx line</li>
<li>Fixed smaller USB AVRs raising multiple connection and disconnection events when NO_LIMITED_CONTROLLER_CONNECT is disabled</li>
<li>Added HOST_DEVICE_SETTLE_DELAY_MS to give the host delay after a device is connected before it is enumerated</li>
<li>Fixed KeyboardHostWithParser demo linking against the wrong global variables</li>
<li>Completed doxygen documentation of remaining library bootloaders, demos and projects</li>
<li>Fixed incorrect bootloader start address in the TeensyHID bootloader</li>
<li>Added HWB button whole-disk ASCII dump functionality to MassStoreHost demo</li>
<li>Replaced printf_P(PSTR("%c"), {Variable}) calls with putchar(&lt;Variable&gt;) for speed and size savings</li>
<li>Serial driver now accepts baud rates over 16-bits in size, added double speed flag option</li>
<li>Fixed incorrect callback abort return value in Pipe.c</li>
<li>Added new flip-ee and dfu-ee makefile targets (courtesy of Opendous Inc.)</li>
<li>Removed reboot-on-disconnect code from the TeensyHID bootloader, caused problems on some systems</li>
<li>Fixed AudioOutput and AudioInput demos looping on the endpoint data, rather than processing a sample at a time and returning each time the task runs to allow for other tasks to execute</li>
<li>Added support for the Atmel ATAVRUSBRF01 board</li>
<li>Added AVRISP Programmer Project, courtesy of Opendous Inc.</li>
<li>Fixed CDC Host demo not searching through both CDC interfaces for endpoints</li>
<li>Fixed incorrect Product String descriptor length in the DFU class bootloader</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog081224">
Version 081224</a></h2>
<ul>
<li>MyUSB name changed to LUFA, the Lightweight USB Framework for AVRs</li>
<li>Fixed Mass Storage Host demo's MassStore_SendCommand() delay in the incorrect place</li>
<li>Fixed USBtoSerial demo not calling ReconfigureUSART() after a change in the line encoding</li>
<li>Fixed infinite loop in host mode Host-to-Device control transfers with data stages</li>
<li>HID report parser now supports devices with multiple reports in one interface via Report IDs</li>
<li>Fixed RZUSBSTICK board LED driver header incorrect macro definition order causing compile errors</li>
<li>Calling <a class="el" href="a00268.html#gaa6fa034a919f41e17908bdcd7d5ae151">USB_Init()</a> when the USB interface is already configured now forces a complete interface reset and re-enumeration - fixes MyUSB DFU bootloader not switching to app code correctly when soft reset used</li>
<li>Fixed "No newline at end of file" warning when stream callbacks are enabled</li>
<li>DFU bootloader now uses fixed signature bytes per device, rather than reading them out dynamically for size</li>
<li>Added new FIXED_CONTROL_ENDPOINT_SIZE and USE_SINGLE_DEVICE_CONFIGURATION switches to statically define certain values to reduce compiled binary size</li>
<li>Added new NO_LIMITED_CONTROLLER_CONNECT switch to prevent the library from trying to determine bus connection state from the suspension and wake up events on the smaller USB AVRs</li>
<li>Added summary of all library compile time tokens to the documentation</li>
<li>Added overview of the LUFA scheduler to the documentation</li>
<li>Removed MANUAL_PLL_CONTROL compile time token, replaced with a mask for the <a class="el" href="a00268.html#gaa6fa034a919f41e17908bdcd7d5ae151">USB_Init()</a> Options parameter</li>
<li>CDC bootloader now uses the correct non-far or far versions of the pgm_* functions depending on if RAMPZ is defined</li>
<li>Doxygen documentation now contains documentation on all the projects, bootloaders and most demos included with the library</li>
<li>CDC bootloader now runs user application when USB disconnected rather than waiting for a hard reset</li>
<li>MouseHostWithParser and KeyboardHostWithParser now support multiple-report devices</li>
<li>RNDIS demo can now close connections correctly using the new TCP_APP_CLOSECONNECTION() macro - used in Webserver</li>
<li>Fixed the DFU bootloader, no longer freezes up when certain files are programmed into an AVR, made reading/writing faster</li>
<li>Fixed mouse/joystick up/down movements reversed - HID mouse X/Y coordinates use a left-handed coordinate system, not a normal right-handed system</li>
<li>Added stub code to the CDC and USBtoSerial demos showing how to read and set the RS-232 handshake lines - not currently used in the demos, but the example code and supporting defines are now in place</li>
<li>Interrupts are now disabled when processing a control request in device mode, to avoid exceeding the strict control request timing requirements.</li>
<li>All demos now use a central StatusUpdate() function rather than direct calls to the board LED functions, so that the demos can easily be altered to show different LED combinations (or do something else entirely) as the demo's status changes</li>
<li>Removed LED commands from the CDC bootloader, unused by most AVR910 programming software</li>
<li>Fixed RNDIS demo ICMP ping requests echoing back incorrect data</li>
<li>Added DHCP server code to RNDIS demo, allowing for hands-free auto configuration on any PC</li>
<li>Fixed DFU bootloader PID value for the ATMEGA16U4 AVR</li>
<li>Endpoint and Pipe configuration functions now return an error code indicating success or failure</li>
<li>USB Reset in device mode now resets and disables all device endpoints</li>
<li>Added intermediate states to the host mode state machine, reducing the USB task blocking time to no more than 1ms explicitly per invocation when in host mode</li>
<li>Added support for the ATMEGA32U6 microcontroller</li>
<li>Added STATIC_ENDPOINT_CONFIGURATION compile time option, enabled in the bootloaders to minimize space usage</li>
<li>Removed redundant code from the USB device GetStatus() chapter 9 processing routine</li>
<li>Added new TeensyHID bootloader, compatible with the Teensy HID protocol (<a href="http://www.pjrc.com/teensy/">http://www.pjrc.com/teensy/</a>)</li>
<li>Versions are now numbered by release dates, rather than arbitrary major/minor revision numbers</li>
<li>USB_RemoteWakeupEnabled is now correctly set and cleared by SetFeature and ClearFeature requests from the host</li>
<li>Changed prototype of GetDescriptor, so that it now returns the descriptor size (or zero if the descriptor doesn't exist) rather than passing the size back to the caller through a parameter and returning a boolean</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog153">
Version 1.5.3 - Released 2nd October, 2008</a></h2>
<ul>
<li>Fixed CDC bootloader using pgmspace macros for some descriptors inappropriately</li>
<li>Updated all Mouse and Keyboard device demos to include boot protocol support (now works in BIOS)</li>
<li>Renamed bootloader directories to remove spaces, which were causing build problems on several OSes</li>
<li>Removed serial number strings from all but the MassStore demo where it is required - users were not modifying the code to either omit the descriptor or use a unique serial per device causing problems when multiple units of the same device were plugged in at the same time</li>
<li>AudioOutput and AudioInput demos now correctly silence endpoints when not enabled by the host</li>
<li>Added KeyboardMouse demo (Keyboard and Mouse functionality combined into a single demo)</li>
<li>Added DriverStubs directory to house board level driver templates, to make MyUSB compatible custom board driver creation easier</li>
<li>Extended MassStorage demo to support multiple LUNs, 2 by default</li>
<li>Fixed incorrect device address mask, preventing the device from enumerating with addresses larger than 63</li>
<li>Fixed incorrect data direction mask in the GetStatus standard request, preventing it from being handled</li>
<li>Fixed incorrect GetStatus standard request for endpoints, now returns the endpoint STALL status correctly</li>
<li>Added in new USB_RemoteWakeupEnabled and USB_CurrentlySelfPowered flags rather than using fixed values</li>
<li>Added DualCDC demo to demonstrate the use of Interface Association Descriptors</li>
<li>Added pipe NAK detection and clearing API</li>
<li>Added pipe status change (NAK, STALL, etc.) interrupt API</li>
<li>Fixed MassStorageHost demo so that it no longer freezes randomly when issuing several commands in a row</li>
<li>Host demos configuration descriptor routines now return a unique error code when the returned data does not have a valid configuration descriptor header</li>
<li>Added <a class="el" href="a00263.html#ga2ee0f0710d9f319a5d5d13f1b6019488">Endpoint_WaitUntilReady()</a> and <a class="el" href="a00271.html#gacb9093cfd973aa4b51fff09cfaa53ba9">Pipe_WaitUntilReady()</a> functions</li>
<li>Stream functions now have software timeouts, timeout period can be set by the USB_STREAM_TIMEOUT_MS token</li>
<li>All demos now pass the USB.org automated Chapter 9 device compliance tests</li>
<li>All HID demos now pass the USB.org automated HID compliance tests</li>
<li>Polling interval of the interrupt endpoint in the CDC based demos changed to 0xFF to fix problems on Linux systems</li>
<li>Changed stream functions to accept a new callback function, with NO_STREAM_CALLBACKS used to disable all callbacks</li>
<li>Mass Storage demo dataflash management routines changed to use the endpoint stream functions</li>
<li>Added AVRStudio project files for each demo in addition to the existing Programmer's Notepad master project file</li>
<li>Re-added call to ReconfigureUSART() in USBtoSerial SetLineCoding request, so that baud rate changes are reflected in the hardware (change was previously lost)</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog152">
Version 1.5.2 - Released 31st July, 2008</a></h2>
<ul>
<li>Fixed <a class="el" href="a00191.html#gaa5ea43b35b98e4f3a78c7c4173ca6cff">SwapEndian_32()</a> function in <a class="el" href="a00074.html">Common.h</a> so that it now works correctly (wrong parameter types)</li>
<li>Updated RNDIS demo - notification endpoint is no longer blocking so that it works with faulty Linux RNDIS implementations (where the notification endpoint is ignored in favour of polling the control endpoint)</li>
<li>Fixed incorrect Vendor Description string return size in RNDIS demo for the OID_GEN_VENDOR_DESCRIPTION OID token</li>
<li>Added very basic TCP/IP stack and HTTP/TELNET servers to RNDIS demo</li>
<li>Fixed DFU bootloader exit causing programming software to complain about failed writes</li>
<li>Fixed DFU bootloader EEPROM programming mode wiping first flash page</li>
<li>Fixed Clear/Set Feature device standard request processing code (fixing MassStorage demo in the process)</li>
<li>Added support for the ATMEGA16U4 AVR microcontroller</li>
<li>Library licence changed from LGPLv3 to MIT license</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog151">
Version 1.5.1 - Released 31st July, 2008</a></h2>
<ul>
<li>Changed host demos to enable the host function task on the firing of the USB_DeviceEnumerationComplete event rather than the USB_DeviceAttached event</li>
<li>HID Usage Stack now forcefully cleared after an IN/OUT/FEATURE item has been completely processed to remove any referenced but not created usages</li>
<li>Changed USB_INT_DisableAllInterrupts() and USB_INT_ClearAllInterrupts(), USB_Host_GetNextDescriptorOfType(), USB_Host_GetNextDescriptorOfTypeBefore(), USB_Host_GetNextDescriptorOfTypeAfter() to normal functions (from inline)</li>
<li>Fixed USBtoSerial demo not sending data, only receiving</li>
<li>Fixed main makefile to make all by default, fixed MagStripe directory case to prevent case-sensitive path problems</li>
<li>ConfigDescriptor functions made normal, instead of static inline</li>
<li>Pipe/Endpoint *_Ignore_* functions changed to *_Discard_*, old names still present as aliases</li>
<li>Fixed ENDPOINT_MAX_SIZE define to be correct on limited USB controller AVRs</li>
<li>Changed endpoint and pipe size translation routines to use previous IF/ELSE IF cascade code, new algorithmic approach was buggy and caused problems</li>
<li>Bootloaders now compile with -fno-inline-small-functions option to reduce code size</li>
<li>Audio demos now use correct endpoint sizes for full and limited controller USB AVRs, double banking in all cases to be in line with the specification (isochronous endpoints MUST be double banked)</li>
<li>Added Interface Association descriptor to <a class="el" href="a00146.html">StdDescriptors.h</a>, based on the relevant USB2.0 ECN</li>
<li>Fixed MIDI demo, corrected Audio Streaming descriptor to follow the MIDI-specific AS structure</li>
<li>Fixed HID class demo descriptors so that the HID interface's protocol is 0x00 (required for non-boot protocol HID devices) to prevent problems on hosts expecting the boot protocol functions to be supported</li>
<li>Added read/write control stream functions to <a class="el" href="a00154.html">Endpoint.h</a></li>
<li>Fixed AudioOut demo not setting port pins to inputs on USB disconnect properly</li>
<li>Added RNDISEthernet demo application</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog150">
Version 1.5.0 - Released 10 June, 2008</a></h2>
<ul>
<li>Fixed MIDI demo, now correctly waits for the endpoint to be ready between multiple note messages</li>
<li>Added CDC Host demo application</li>
<li>Added KeyboardFullInt demo application</li>
<li>Endpoint and Pipe creation routines now mask endpoint/pipe size with the size mask, to remove transaction size bits not required for the routines (improves compatibility with devices)</li>
<li>Fixed AudioInput demo - now correctly sends sampled audio to the host PC</li>
<li>Fixed AudioOutput demo once more -- apparently Windows requires endpoint packets to be &gt;=192 bytes</li>
<li>Shrunk round-robbin scheduler code slightly via the use of struct pointers rather than array indexes</li>
<li>Fixed off-by-one error when determining if the Usage Stack is full inside the HID Report parser</li>
<li>Renamed Magstripe.h to MagstripeHW.h and moved driver out of the library and into the MagStripe demo folder</li>
<li>Added preprocessor checks to enable C linkage on the library components when used with a C++ compiler</li>
<li>Added Still Image Host demo application</li>
<li>The USB device task now restores the previously selected endpoint, allowing control requests to be transparently handled via interrupts while other endpoints are serviced through polling</li>
<li>Fixed device signature being sent in reverse order in the CDC bootloader</li>
<li>Host demos now have a separate ConfigDescriptor.c/.h file for configuration descriptor processing</li>
<li>HostWithParser demos now have a separate HIDReport.c/.h file for HID report processing and dumping</li>
<li>Removed non-mandatory commands from MassStorage demo to save space, fixed SENSE ResponseCode value</li>
<li>CDC demos now send empty packets after sending a full one to prevent buffering issues on the host</li>
<li>Updated demo descriptors to use VID/PID values donated by Atmel</li>
<li>Added DoxyGen documentation to the source files</li>
<li>Fixed <a class="el" href="a00223.html#ga331eab2f9e05ddc371a7c3f7384807db">Serial_IsCharReceived()</a> definition, was previously reversed</li>
<li>Removed separate USB_Descriptor_Language_t descriptor, <a class="el" href="a00057.html">USB_Descriptor_String_t</a> is used instead</li>
<li>Removed unused Device Qualifier descriptor structure</li>
<li>Renamed the USB_CreateEndpoints event to the more appropriate USB_ConfigurationChanged</li>
<li>Fixed MassStorageHost demo reading in the block data in reverse</li>
<li>Removed outdated typedefs in <a class="el" href="a00147.html">StdRequestType.h</a>, superseded by the macro masks</li>
<li>Corrected <a class="el" href="a00158.html">OTG.h</a> is now included when the AVR supports both Host and Device modes, for creating OTG products</li>
<li>USB_DeviceEnumerationComplete event is now also fired when in device mode and the host has finished its enumeration</li>
<li>Interrupt driven demos now properly restore previously selected endpoint when ISR is complete</li>
<li>USB_HOST_TIMEOUT_MS is now overridable in the user project makefile to a custom fixed timeout value</li>
<li>Renamed USB_Host_SOFGeneration_* macros to more friendly <a class="el" href="a00267.html#gad0e10b9558daf18dbce13325b1442e81">USB_Host_SuspendBus()</a>, <a class="el" href="a00267.html#gaab0e1e5d3d33552dc89b5a3c7c8c1561">USB_Host_ResumeBus()</a> and <a class="el" href="a00267.html#gabe80fe778471cc3330a85cbe2b1c49c4">USB_Host_IsBusSuspended()</a></li>
<li>Renamed *_*_Is* macros to *_Is* to make all flag checking macros consistent, Pipe_SetInterruptFreq() is now <a class="el" href="a00270.html#ga8f724c6a0c881f2a3b33fb95faea0742">Pipe_SetInterruptPeriod()</a> to use the correct terminology</li>
<li>UnicodeString member of <a class="el" href="a00057.html">USB_Descriptor_String_t</a> struct changed to an ordinary int array type, so that the GCC Unicode strings (prefixed with an L before the opening quotation mark) can be used instead of explicit arrays of ASCII characters</li>
<li>Fixed Endpoint/Pipes being configured incorrectly if the maximum endpoint/pipe size for the selected USB AVR model was given as the bank size</li>
<li>HID device demos now use a true raw array for the HID report descriptor rather than a struct wrapped array</li>
<li>Added <a class="el" href="a00258.html#ga40a667815d7089266f5e2ea33c2cc157">VERSION_BCD()</a> macro, fixed reported HID and USB version numbers in demo descriptors</li>
<li>Cleaned up GetDescriptor device chapter 9 handler function</li>
<li>Added GET_REPORT class specific request to HID demos to make them complaint to the HID class</li>
<li>Cleaned up setting of USB_IsInitialized and USB_IsConnected values to only when needed</li>
<li>Removed Atomic.c and ISRMacro.h; the library was already only compatible with recent avr-lib-c for other reasons</li>
<li>All demos and library functions now use USB standardized names for the USB data (bRequest, wLength, etc.)</li>
<li>Added USE_NONSTANDARD_DESCRIPTOR_NAMES token to switch back to the non-standard descriptor element names</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog141">
Version 1.4.1 - Released 5 May, 2008</a></h2>
<ul>
<li>Enhanced KeyboardWithParser demo, now prints out pressed alphanumeric characters like the standard demo</li>
<li>Fixed MassStorage demo, read/writes using non mode-10 commands now work correctly</li>
<li>Corrected version number in <a class="el" href="a00187.html">Version.h</a></li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog140">
Version 1.4.0 - Released 5 May, 2008</a></h2>
<ul>
<li>Added HID Report Parser API to the library</li>
<li>Added Mouse and Keyboard host demo applications, using the new HID report parser engine</li>
<li>Added MouseFullInt demo, which demonstrates a fully interrupt (including control requests) mouse device</li>
<li>Fixed incorrect length value in the audio control descriptor of the AudioOutput and AudioInput demos</li>
<li>Added MIDI device demo application to the library</li>
<li>Fixed problem preventing USB devices from being resumed from a suspended state</li>
<li>Added new CDC class bootloader to the library, based on the AVR109 bootloader protocol</li>
<li>Added header to each demo application indicating the mode, class, subclass, standards used and supported speed</li>
<li>Functions expecting endpoint/pipe numbers are no longer automatically masked against ENDPOINT_EPNUM_MASK or PIPE_PIPENUM_MASK - this should be manually added to code which requires it</li>
<li>Fixed DFU class bootloader - corrected frequency of flash page writes, greatly reducing programming time</li>
<li>Renamed AVR_HOST_GetDeviceConfigDescriptor() to <a class="el" href="a00256.html#gacb936f8021d9ec7f59b5e8dbea6314c4">USB_Host_GetDeviceConfigDescriptor()</a> and AVR_HOST_GetNextDescriptor() to USB_Host_GetNextDescriptor()</li>
<li>Added new USB_Host_GetNextDescriptorOfTypeBefore() and USB_Host_GetNextDescriptorOfTypeAfter() routines</li>
<li>Moved configuration descriptor routines to MyUSB/Drivers/USB/Class/, new accompanying ConfigDescriptors.c file</li>
<li>Added new configuration descriptor comparator API for more powerful descriptor parsing, updated host demos to use the new comparator API</li>
<li>Fixed MassStorageHost demo capacity printout, and changed data read/write mode from little-endian to the correct big-endian for SCSI devices</li>
<li>Fixed macro/function naming consistency; USB_HOST is now USB_Host, USB_DEV is now USB_Device</li>
<li>Added better error reporting to host demos</li>
<li>Added 10 microsecond delay after addressing devices in host mode, to prevent control stalls</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog132">
Version 1.3.2 - Released April 1st, 2008</a></h2>
<ul>
<li>Added call to ReconfigureUSART() in USBtoSerial SetLineCoding request, so that baud rate changes are reflected in the hardware</li>
<li>Fixed CDC and USBtoSerial demos - Stream commands do not work for control endpoints, and the GetLineCoding request had an incorrect RequestType mask preventing it from being processed</li>
<li>Improved reliability of the USBtoSerial demo, adding a busy wait while the buffer is full</li>
<li>Device control endpoint size is now determined from the device's descriptors rather than being fixed</li>
<li>Separated out SPI code into new SPI driver in AT90USBXXX driver directory</li>
<li>Bootloader now returns correct PID for the selected USB AVR model, not just the AT90USB128X PID</li>
<li>Added support for the RZUSBSTICK board</li>
<li>Bicolour driver removed in favour of generic LEDs driver</li>
<li>Added support for the ATMEGA32U4 AVR</li>
<li>Added MANUAL_PLL_CONTROL compile time option to prevent the USB library from manipulating the PLL</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog131">
Version 1.3.1 - Released March 19th 2008</a></h2>
<ul>
<li>Fixed USB to Serial demo - class value in the descriptors was incorrect</li>
<li>Control endpoint size changed from 64 bytes to 8 bytes to save on USB FIFO RAM and to allow low speed mode devices to enumerate properly</li>
<li>USB to Serial demo data endpoints changed to dual-banked 16 byte to allow the demo to work on USB AVRs with limited USB FIFO RAM</li>
<li>Changed demo endpoint numbers to use endpoints 3 and 4 for double banking, to allow limited USB device controller AVRs (AT90USB162, AT90USB82) to function correctly</li>
<li>Updated Audio Out demo to use timer 1 for AVRs lacking a timer 3 for the PWM output</li>
<li>Fixed incorrect USB_DEV_OPT_HIGHSPEED entry in the Mass Storage device demo makefile</li>
<li>Optimized Mass Storage demo for a little extra transfer speed</li>
<li>Added LED indicators to the Keyboard demo for Caps Lock, Num Lock and Scroll Lock</li>
<li>Added Endpoint_Read_Stream, Endpoint_Write_Stream, Pipe_Read_Stream and Pipe_Write_Stream functions (including Big and Little Endian variants)</li>
<li>Made Dataflash functions inline for speed, removed now empty Dataflash.c driver file</li>
<li>Added new SetSystemClockPrescaler() macro (thanks to Joerg Wunsch)</li>
<li>Fixed <a class="el" href="a00266.html#gae47540878d639c8c82e80bc0abc1a862">Endpoint_ClearStall()</a> to function correctly on full USB controller AVRs (AT90USBXXX6/7)</li>
<li>Endpoint_Setup_In_Clear() and Endpoint_Setup_Out_Clear() no longer set FIFOCON, in line with the directives in the datasheet</li>
<li>Fixed PLL prescaler defines for all AVR models and frequencies</li>
<li>Fixed ENDPOINT_INT_IN and ENDPOINT_INT_OUT definitions</li>
<li>Added interrupt driven keyboard and mouse device demos</li>
<li>Combined USB_Device_ClearFeature and USB_Device_SetFeature requests into a single routine for code size savings</li>
<li>Added missing <a class="el" href="a00270.html#ga0727bc193dc32084e88d6e5cc4b55d1e">Pipe_GetCurrentPipe()</a> macro to <a class="el" href="a00159.html">Pipe.h</a></li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog130">
Version 1.3.0 - Released March 7th 2008</a></h2>
<ul>
<li>Unnecessary control endpoint config removed from device mode</li>
<li>Fixed device standard request interpreter accidentally processing some class-specific requests</li>
<li>Added USE_RAM_DESCRIPTORS and USE_EEPROM_DESCRIPTORS compile time options to instruct the library to use descriptors stored in RAM or EEPROM rather than flash memory</li>
<li>All demos now disable watchdog on startup, in case it has been enabled by fuses or the bootloader</li>
<li>USB_DEV_OPT_LOWSPEED option now works correctly</li>
<li>Added ability to set the USB options statically for a binary size reduction via the USE_STATIC_OPTIONS compile time define</li>
<li>USB_Init no longer takes a Mode parameter if compiled for a USB device with no host mode option, or if forced to a particular mode via the USB_HOST_ONLY or USB_DEVICE_ONLY compile time options</li>
<li>USB_Init no longer takes an Options parameter if options statically configured by USE_STATIC_OPTIONS</li>
<li>Endpoint_Ignore_* and Pipe_Ignore_* made smaller by making the dummy variable non-volatile so that the compiler can throw away the result more efficiently</li>
<li>Added in an optional GroupID value to each scheduler entry, so that groups of tasks can once again be controlled by the new <a class="el" href="a00281.html#ga200bd182eca1ac8233fed8e13ffd5d22">Scheduler_SetGroupTaskMode()</a> routine</li>
<li>Added support for AT90USB162 and AT90USB82 AVR models</li>
<li>Added support for the STK525 and STK526 boards</li>
<li>Added support for custom board drivers to be supplied by selecting the board type as BOARD_USER, and placing board drivers in {Application Directory}/Board/</li>
<li>PLL is now stopped and USB clock is frozen when detached from host in device mode, to save power</li>
<li>Joystick defines are now in synch with the schematics - orientation will be rotated for the USBKEY</li>
<li>Fixed USB_DEV_IsUSBSuspended() - now checks the correct register</li>
<li>Fixed data transfers to devices when in host mode</li>
<li>Renamed USB_DEV_OPT_HIGHSPEED to USB_DEV_OPT_FULLSPEED and USB_HOST_IsDeviceHighSpeed() to USB_HOST_IsDeviceFullSpeed() to be in line with the official USB speed names (to avoid confusion with the real high speed mode, which is unavailable on the USB AVRs)</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog120">
Version 1.2.0 - Released February 4th, 2008</a></h2>
<ul>
<li>Added USB_DeviceEnumerationComplete event for host mode</li>
<li>Added new Scheduler_Init routine to preprepare the scheduler, so that tasks can be started and stopped before the scheduler has been started (via Scheduler_Start)</li>
<li>Connection events in both Device and Host mode are now interrupt-driven, allowing the USB management task to be stopped when the USB is not connected to a host or device</li>
<li>All demos updated to stop the USB task when not in use via the appropriate USB events</li>
<li>Mass Storage Host demo application updated to function correctly with all USB flash disks</li>
<li>Mass Storage Host demo application now prints out the capacity and number of LUNs in the attached device, and prints the first block as hexadecimal numbers rather than ASCII characters</li>
<li>Endpoint and Pipe clearing routines now clear the Endpoint/Pipe interrupt and status flags</li>
<li>Shifted error handling code in the host enum state machine to a single block, to reduce code complexity</li>
<li>Added in DESCRIPTOR_TYPE, DESCRIPTOR_SIZE and DESCRIPTOR_CAST macros to make config descriptor processing clearer in USB hosts and DESCRIPTOR_ADDRESS for convenience in USB devices</li>
<li>Added in alloca macro to common.h, in case the user is using an old version of avr-lib-c missing the macro</li>
</ul>
<h2><a class="anchor" id="Sec_ChangeLog130">
Version 1.3.0 - Released March 7th 2008</a></h2>
<ul>
<li>Fixed DCONNI interrupt being enabled accidentally after a USB reset</li>
<li>Fixed DDISCI interrupt not being disabled when a device is not connected</li>
<li>Added workaround for powerless pullup devices causing false disconnect interrupts</li>
<li>Added USB_DeviceEnumerationFailed event for Host mode</li>
<li>AVR_HOST_GetDeviceConfigDescriptor routine no longer modifies ConfigSizePtr if a valid buffer pointer is passed</li>
<li>Added ALLOCABLE_BYTES to DynAlloc, and added code to make the size of key storage variables dependant on size of memory parameters passed in via the user project's makefile</li>
<li>Fixed incorrect device reset routine being called in USBTask</li>
<li>Devices which do not connect within the standard 300mS are now supported</li>
<li>Removed incorrect ATTR_PURE from <a class="el" href="a00281.html#ga127a96f23474f8e7657adc6afb8af282">Scheduler_SetTaskMode()</a>, which was preventing tasks from being started/stopped, as well as USB_InitTaskPointer(), which was breaking dual device/host USB projects</li>
<li>Changed scheduler to use the task name rather than IDs for setting the task mode, eliminating the need to have a task ID list</li>
<li>ID transistion interrupt now raises the appropriate device/host disconnect event if device attached</li>
<li>Fixed double VBUS change (and VBUS -) event when detatching in device mode</li>
<li>Added ability to disable ANSI terminal codes by the defining of DISABLE_TERMINAL_CODES in makefile</li>
<li>Removed return from ConfigurePipe and ConfigureEndpoint functions - use <a class="el" href="a00270.html#gaea89581885458b97dd298e765673d67d">Pipe_IsConfigured()</a> and <a class="el" href="a00262.html#ga14786993ad0006ed489d16f75fe6c2ea">Endpoint_IsConfigured()</a> after calling the config functions to determine success </li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Dec 2009 for LUFA (Formerly MyUSB) Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
